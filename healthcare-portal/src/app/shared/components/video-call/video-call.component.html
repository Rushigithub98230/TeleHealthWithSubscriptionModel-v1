<div class="video-call-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-overlay">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Connecting to video call...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <mat-card>
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        <h3>Connection Error</h3>
        <p>{{ error }}</p>
        <button mat-raised-button color="primary" (click)="joinExistingSession()">
          <mat-icon>refresh</mat-icon>
          Retry Connection
        </button>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Video Call Interface -->
  <div *ngIf="!loading && !error" class="video-call-interface">
    <!-- Video Area -->
    <div class="video-area">
      <!-- Publisher (Local Video) -->
      <div class="publisher-container">
        <div id="publisher" class="publisher-video"></div>
        <div class="publisher-overlay">
          <mat-chip color="primary" selected>You</mat-chip>
          <div class="connection-quality" [style.background-color]="getConnectionQualityColor()"></div>
        </div>
      </div>

      <!-- Subscribers (Remote Videos) -->
      <div class="subscribers-container">
        <div id="subscribers" class="subscribers-video"></div>
        <div *ngIf="participants.length === 1" class="waiting-message">
          <mat-icon>person_add</mat-icon>
          <p>Waiting for other participants to join...</p>
        </div>
      </div>
    </div>

    <!-- Call Controls -->
    <div class="call-controls">
      <!-- Call Duration -->
      <div class="call-duration">
        <mat-icon>schedule</mat-icon>
        <span>{{ getCallDuration() }}</span>
      </div>

      <!-- Control Buttons -->
      <div class="control-buttons">
        <!-- Mute Button -->
        <button 
          mat-fab 
          [color]="videoCallState.isMuted ? 'warn' : 'primary'"
          (click)="toggleMute()"
          matTooltip="{{ videoCallState.isMuted ? 'Unmute' : 'Mute' }}">
          <mat-icon>{{ videoCallState.isMuted ? 'mic_off' : 'mic' }}</mat-icon>
        </button>

        <!-- Video Button -->
        <button 
          mat-fab 
          [color]="videoCallState.isVideoEnabled ? 'primary' : 'warn'"
          (click)="toggleVideo()"
          matTooltip="{{ videoCallState.isVideoEnabled ? 'Turn off video' : 'Turn on video' }}">
          <mat-icon>{{ videoCallState.isVideoEnabled ? 'videocam' : 'videocam_off' }}</mat-icon>
        </button>

        <!-- Screen Share Button -->
        <button 
          mat-fab 
          [color]="videoCallState.isScreenSharing ? 'accent' : 'primary'"
          (click)="toggleScreenSharing()"
          matTooltip="Screen share">
          <mat-icon>screen_share</mat-icon>
        </button>

        <!-- Recording Button (Provider Only) -->
        <button 
          *ngIf="userRole === 'provider'"
          mat-fab 
          [color]="videoCallState.isRecording ? 'warn' : 'primary'"
          (click)="toggleRecording()"
          matTooltip="{{ videoCallState.isRecording ? 'Stop recording' : 'Start recording' }}">
          <mat-icon>{{ videoCallState.isRecording ? 'stop' : 'fiber_manual_record' }}</mat-icon>
        </button>

        <!-- End Call Button -->
        <button 
          mat-fab 
          color="warn"
          (click)="endCall()"
          matTooltip="End call">
          <mat-icon>call_end</mat-icon>
        </button>
      </div>

      <!-- Participants Count -->
      <div class="participants-count">
        <mat-icon>people</mat-icon>
        <span>{{ participants.length }} participant{{ participants.length !== 1 ? 's' : '' }}</span>
      </div>
    </div>

    <!-- Recording Indicator -->
    <div *ngIf="videoCallState.isRecording" class="recording-indicator">
      <mat-icon color="warn">fiber_manual_record</mat-icon>
      <span>Recording in progress...</span>
    </div>

    <!-- Connection Quality Indicator -->
    <div class="connection-quality-indicator">
      <mat-icon [style.color]="getConnectionQualityColor()">signal_cellular_alt</mat-icon>
      <span>{{ connectionQuality }} connection</span>
    </div>
  </div>

  <!-- Call Ended Dialog -->
  <div *ngIf="!videoCallState.isInCall && !loading" class="call-ended">
    <mat-card>
      <mat-card-content>
        <mat-icon color="primary">call_end</mat-icon>
        <h3>Call Ended</h3>
        <p>Duration: {{ getCallDuration() }}</p>
        <button mat-raised-button color="primary" (click)="callEnded.emit()">
          <mat-icon>close</mat-icon>
          Close
        </button>
      </mat-card-content>
    </mat-card>
  </div>
</div> 