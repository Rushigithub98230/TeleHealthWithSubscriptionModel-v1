<div class="message-item" [class.own-message]="isOwnMessage">
  <!-- Avatar -->
  <div class="message-avatar" *ngIf="showAvatar && !isOwnMessage">
    <img [src]="'assets/default-avatar.png'" [alt]="message.senderName">
  </div>

  <!-- Message Content -->
  <div class="message-content">
    <!-- Message Header -->
    <div class="message-header" *ngIf="showTimestamp">
      <span class="sender-name" *ngIf="!isOwnMessage">{{ message.senderName }}</span>
      <span class="message-time">{{ formatMessageTime(message.createdAt) }}</span>
      <span class="message-status" *ngIf="isOwnMessage">
        <mat-icon [class.read]="isMessageRead()" [class.sent]="!isMessageRead()">
          {{ isMessageRead() ? 'done_all' : 'done' }}
        </mat-icon>
      </span>
    </div>

    <!-- Message Body -->
    <div class="message-body">
      <!-- Text Message -->
      <div *ngIf="isTextMessage()" class="text-message">
        <div *ngIf="!isEditing" class="message-text">
          {{ message.content }}
        </div>
        <div *ngIf="isEditing" class="edit-form">
          <textarea 
            [(ngModel)]="editText" 
            (keydown.enter)="saveEdit()"
            (keydown.escape)="cancelEdit()"
            placeholder="Edit message..."
            rows="2">
          </textarea>
          <div class="edit-actions">
            <button mat-button color="primary" (click)="saveEdit()">Save</button>
            <button mat-button (click)="cancelEdit()">Cancel</button>
          </div>
        </div>
      </div>

      <!-- File Message -->
      <div *ngIf="isFileMessage()" class="file-message" (click)="downloadFile()">
        <mat-icon>{{ getFileIcon() }}</mat-icon>
        <div class="file-info">
          <div class="file-name">{{ message.fileName }}</div>
          <div class="file-size" *ngIf="message.fileSize">{{ formatFileSize(message.fileSize) }}</div>
        </div>
        <button mat-icon-button>
          <mat-icon>download</mat-icon>
        </button>
      </div>

      <!-- Image Message -->
      <div *ngIf="isImageMessage()" class="image-message">
        <img [src]="message.content" [alt]="message.fileName" (click)="openImageDialog()">
        <div class="image-overlay" (click)="openImageDialog()">
          <mat-icon>zoom_in</mat-icon>
        </div>
      </div>

      <!-- Audio Message -->
      <div *ngIf="isAudioMessage()" class="audio-message">
        <div class="audio-player">
          <mat-icon>audiotrack</mat-icon>
          <div class="audio-info">
            <div class="audio-name">{{ message.fileName }}</div>
            <div class="audio-duration">{{ formatFileSize(message.fileSize || 0) }}</div>
          </div>
          <button mat-icon-button (click)="playMedia()">
            <mat-icon>play_arrow</mat-icon>
          </button>
        </div>
      </div>

      <!-- Video Message -->
      <div *ngIf="isVideoMessage()" class="video-message">
        <video [src]="message.content" controls>
          <source [src]="message.content" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        <div class="video-overlay" (click)="playMedia()">
          <mat-icon>play_arrow</mat-icon>
        </div>
      </div>
    </div>

    <!-- Message Reactions -->
    <div class="message-reactions" *ngIf="showReactions && message.reactions.length > 0">
      <div *ngFor="let emoji of commonReactions" 
           class="reaction" 
           [class.has-reaction]="hasReaction(emoji)"
           (click)="addReaction(emoji)"
           [matTooltip]="getReactionUsers(emoji)">
        <span class="emoji">{{ emoji }}</span>
        <span class="count" *ngIf="getReactionCount(emoji) > 0">{{ getReactionCount(emoji) }}</span>
      </div>
    </div>

    <!-- Reaction Picker -->
    <div class="reaction-picker" *ngIf="showReactionPicker">
      <div class="reaction-options">
        <button *ngFor="let emoji of commonReactions" 
                class="reaction-option"
                (click)="addReaction(emoji)"
                [matTooltip]="emoji">
          {{ emoji }}
        </button>
      </div>
    </div>
  </div>

  <!-- Message Actions -->
  <div class="message-actions" *ngIf="showMenu">
    <button mat-icon-button [matMenuTriggerFor]="messageMenu" class="action-button">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #messageMenu="matMenu">
      <button mat-menu-item (click)="addReaction('üëç')">
        <mat-icon>thumb_up</mat-icon>
        <span>üëç Like</span>
      </button>
      <button mat-menu-item (click)="replyToMessage()">
        <mat-icon>reply</mat-icon>
        <span>Reply</span>
      </button>
      <button mat-menu-item (click)="copyMessage()" *ngIf="isTextMessage()">
        <mat-icon>content_copy</mat-icon>
        <span>Copy</span>
      </button>
      <button mat-menu-item (click)="startEdit()" *ngIf="canEdit()">
        <mat-icon>edit</mat-icon>
        <span>Edit</span>
      </button>
      <button mat-menu-item (click)="deleteMessage()" *ngIf="canDelete()">
        <mat-icon>delete</mat-icon>
        <span>Delete</span>
      </button>
      <button mat-menu-item (click)="downloadFile()" *ngIf="isFileMessage()">
        <mat-icon>download</mat-icon>
        <span>Download</span>
      </button>
      <button mat-menu-item (click)="openImageDialog()" *ngIf="isImageMessage()">
        <mat-icon>zoom_in</mat-icon>
        <span>View Image</span>
      </button>
      <button mat-menu-item (click)="playMedia()" *ngIf="isAudioMessage() || isVideoMessage()">
        <mat-icon>play_arrow</mat-icon>
        <span>Play</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="reportMessage()">
        <mat-icon>report</mat-icon>
        <span>Report</span>
      </button>
    </mat-menu>
  </div>
</div> 