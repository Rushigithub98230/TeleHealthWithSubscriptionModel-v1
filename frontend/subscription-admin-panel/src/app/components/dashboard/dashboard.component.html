<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1>Subscription Management Admin Panel</h1>
      <div class="user-info">
        <span *ngIf="currentUser$ | async as user">
          Welcome, {{ user.firstName }} {{ user.lastName }}
        </span>
        <button mat-button (click)="logout()">Logout</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="dashboard-content">
    <!-- Statistics Cards -->
    <div class="stats-grid" *ngIf="dashboardStats$ | async as stats">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-value">{{ stats.totalSubscriptions }}</div>
          <div class="stat-label">Total Subscriptions</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-value">{{ stats.activeSubscriptions }}</div>
          <div class="stat-label">Active Subscriptions</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-value">${{ stats.totalRevenue | number:'1.0-0' }}</div>
          <div class="stat-label">Total Revenue</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-value">${{ stats.monthlyRecurringRevenue | number:'1.0-0' }}</div>
          <div class="stat-label">Monthly Recurring Revenue</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-value">{{ stats.totalUsers }}</div>
          <div class="stat-label">Total Users</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-value">{{ stats.pendingPayments }}</div>
          <div class="stat-label">Pending Payments</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h2>Quick Actions</h2>
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="createNewSubscription()">
          <mat-icon>add</mat-icon>
          Create Subscription
        </button>
        <button mat-raised-button color="accent" (click)="createNewPlan()">
          <mat-icon>add_circle</mat-icon>
          Create Plan
        </button>
        <button mat-raised-button color="warn" (click)="triggerBilling()">
          <mat-icon>payment</mat-icon>
          Trigger Billing
        </button>
        <button mat-raised-button color="primary" (click)="viewAnalytics()">
          <mat-icon>analytics</mat-icon>
          View Analytics
        </button>
      </div>
    </div>

    <!-- Recent Subscriptions -->
    <div class="recent-subscriptions">
      <h2>Recent Subscriptions</h2>
      <table mat-table [dataSource]="(subscriptions$ | async) || []" class="subscription-table">
        <ng-container matColumnDef="user">
          <th mat-header-cell *matHeaderCellDef>User</th>
          <td mat-cell *matCellDef="let subscription">{{ subscription.userName }}</td>
        </ng-container>

        <ng-container matColumnDef="plan">
          <th mat-header-cell *matHeaderCellDef>Plan</th>
          <td mat-cell *matCellDef="let subscription">{{ subscription.planName }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let subscription">
            <span class="status-badge" [class]="'status-' + subscription.status.toLowerCase()">
              {{ subscription.status }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="price">
          <th mat-header-cell *matHeaderCellDef>Price</th>
          <td mat-cell *matCellDef="let subscription">${{ subscription.currentPrice }}</td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let subscription">
            <button mat-icon-button [matMenuTriggerFor]="menu">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="viewSubscription(subscription.id)">
                <mat-icon>visibility</mat-icon>
                View Details
              </button>
              <button mat-menu-item (click)="pauseSubscription(subscription.id)" *ngIf="subscription.status === 'Active'">
                <mat-icon>pause</mat-icon>
                Pause
              </button>
              <button mat-menu-item (click)="resumeSubscription(subscription.id)" *ngIf="subscription.status === 'Paused'">
                <mat-icon>play_arrow</mat-icon>
                Resume
              </button>
              <button mat-menu-item (click)="cancelSubscription(subscription.id)">
                <mat-icon>cancel</mat-icon>
                Cancel
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['user', 'plan', 'status', 'price', 'actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['user', 'plan', 'status', 'price', 'actions'];"></tr>
      </table>
    </div>

    <!-- Available Plans -->
    <div class="available-plans">
      <h2>Available Plans</h2>
      <div class="plans-grid" *ngIf="plans$ | async as plans">
        <mat-card *ngFor="let plan of plans" class="plan-card">
          <mat-card-header>
            <mat-card-title>{{ plan.name }}</mat-card-title>
            <mat-card-subtitle>{{ plan.description }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="plan-price">${{ plan.price }}/{{ plan.billingCycle }}</div>
            <div class="plan-features">
              <div *ngIf="plan.isTrialAllowed" class="trial-info">
                {{ plan.trialDurationInDays }} days trial
              </div>
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button (click)="editPlan(plan.id)">Edit</button>
            <button mat-button color="warn" (click)="deletePlan(plan.id)">Delete</button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>
</div>
